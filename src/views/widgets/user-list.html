<template>

    <require from="../widgets/inputs/form-input"></require>
    <require from="../widgets/inputs/form-filter-text"></require>
    <require from="../widgets/inputs/form-filter-role"></require>
    <require from="../widgets/inputs/form-select"></require>
    <require from="../../resources/format/format-date"></require>
    <require from="../widgets/cust-span/span-cust-member-status"></require>
    <require from="../widgets/cust-span/span-cust-active-status"></require>

    <!--<div class="hdr-wrap" if.bind="!custHideTitleBar">
        <h1 class="hdr-inline">${title}<span class="html-file-name">(user-list.html)</span></h1>
        <a class="btn btn-default btn-i pull-right" click.delegate="addUser()">
            <i class="fa fa-plus"></i>Add User
        </a>
    </div>-->

    <p if.bind="debugShowOutput">found: ${found} / ${selectedId} / filter: ${filters}</p>
    <p if.bind="debugShowOutput">rolesArrDynamic: ${rolesArrDynamic}</p>
    <p if.bind="debugShowOutput">filters[1].value: ${filters[1].value} / ${rolesArrDynamic}</p>

    <div class="panel panel-default panel-xc">
        <div class="panel-heading ${custXc ? 'cursor-hover' : ''} ${custXcExpanded ? '' : 'collapsed'}" data-toggle="collapse" data-target="#${custXcId}">
            ${title}
            <button if.bind="custXc" class="btn btn-xc_chevron btn-xs" type="button" aria-expanded="${custXcExpanded}" aria-controls="collapseExample">
            </button>

            <a class="btn btn-xs btn-i btn-text pull-right" click.delegate="addUser()">
                <i class="fa fa-plus"></i>Add User
            </a>
        </div>

        <div id="${custXcId}" class="panel-body bg-white ${custXc ? 'collapse' : ''} ${custXcExpanded ? 'in' : ''}">
            <!-- Filters -->
            <div class="row margin-y-g1">
                <div class="col-xs-4">
                    <form-filter-text model.two-way="filters[0].value"></form-filter-text>
                </div>
                <div class="col-xs-4">
                    <form-filter-role inp-label="Role" model.two-way="filters[1].value" options.bind="filter_role" changed.two-way="filters[1].value"
                        init-selected.two-way="filters[1].value"></form-filter-role>
                </div>
                <div class="col-xs-4">

                    <form-filter-role inp-label="Status" model.two-way="filters[2].value" options.bind="filter_active" changed.two-way="filters[2].value"
                        init-selected.two-way="filters[2].value"></form-filter-role>
                </div>
            </div>
            <!-- (END) Filters -->

            <!-- Table -->
            <div class="row">
                <div class="col-xs-12">
                    <table class="table table-striped" aurelia-table="data.bind: users.data; display-data.bind: $displayData; filters.bind: filters; current-page.bind: currentPage; page-size.bind: custTablePageSize; total-items.bind: totalItems;">
                        <thead>
                            <tr>
                                <th aut-sort="key: id; default: desc" if.bind="isNotDisabled('id')">id</th>
                                <th aut-sort="key: loginName" if.bind="isNotDisabled('loginName')">Login Name</th>
                                <th aut-sort="key: firstName" if.bind="isNotDisabled('firstName')">First Name</th>
                                <th aut-sort="key: lastName" if.bind="isNotDisabled('lastName')">Last Name</th>
                                <th aut-sort="key: emailAddress" if.bind="isNotDisabled('emailAddress')">Last Name</th>
                                <th aut-sort="key: isMember" if.bind="isNotDisabled('isMember')">Profile</th>
                                <th aut-sort="key: isActive" if.bind="isNotDisabled('isActive')">Status</th>
                                <th if.bind="isNotDisabled('edit')">Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr repeat.for="user of $displayData" class="${user.id === $parent.selectedId ? 'active' : ''}">
                                <td if.bind="isNotDisabled('id')">${user.id}</td>
                                <td if.bind="isNotDisabled('loginName')">${user.loginName}</td>
                                <td if.bind="isNotDisabled('firstName')">${user.firstName}</td>
                                <td if.bind="isNotDisabled('lastName')">${user.lastName}</td>
                                <td if.bind="isNotDisabled('emailAddress')">${user.emailAddress}</td>
                                <td if.bind="isNotDisabled('isMember')">
                                    <span-cust-member-status is-member.bind="user.isMember" update-pending.bind="user.updatePending" profile-date.bind="user.profileDate"></span-cust-member-status>
                                </td>
                                <td if.bind="isNotDisabled('isActive')">
                                    <span-cust-active-status is-active.bind="user.isActive" review-pending.bind="user.reviewPending" review-result.bind="user.reviewResult"></span-cust-active-status>
                                </td>
                                <td if.bind="isNotDisabled('edit')">
                                    <div class="btn-group btn-group-xs" role="group" aria-label="User actions">
                                        <a class="btn btn-default" route-href="route: user-edit; params.bind: {id:user.id, editType:'edit'}" title="Full edit">
                                            <i class="fa fa-list"></i>
                                        </a>
                                        <button disabled.bind="user.emailAddress==null" class="btn btn-default" href="mailto:${user.emailAddress}" title="Email User">
                                                <i class="fa fa-envelope-o"></i>
                                            </button>
                                        <a class="btn btn-default" click.delegate="changeUserRoles(user.id)" title="Change User Permissions">
                                            <i class="fa fa-cog"></i>
                                        </a>
                                        <a class="btn btn-default" click.delegate="deleteUser(user.id)" title="Delete User">
                                            <i class="fa fa-trash"></i>
                                        </a>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>



            </div>
            <!-- (END) Table -->

            <!-- Pagination -->
            <div class="row margin-bottom-g1 display-none" if.bind="custTablePagination">

                <div class="col-md-7">
                    <aut-pagination current-page.bind="currentPage" page-size.bind="custTablePageSize" total-items.bind="totalItems" pagination-size.bind="5"
                        boundary-links.bind="true"> </aut-pagination>
                </div>

                <div class="col-md-5">
                    <div class="form-inline">
                        <div class="form-group pull-right">
                            <label for="custTablePageSize">Page Size: </label>
                            <select value.bind="custTablePageSize" id="custTablePageSize" class="form-control">
                        <option model.bind="5">5</option>
                        <option model.bind="10">10</option>
                        <option model.bind="20">20</option>
                        <option model.bind="50">50</option>
                        <option model.bind="100">100</option>
                    </select>
                        </div>
                    </div>
                </div>
            </div>
            <!-- (END) Pagination -->

        </div>
    </div>

</template>